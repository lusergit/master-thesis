% !TeX root = mod.tex
\section{Computing interval semantics}\label{sec:computingint}

Lemma~\ref{le:inc} provides an effective algorithm for computing the abstract
semantics of commands%  provided a domain that respects properties \ref{inc:hp1}
% and \ref{inc:hp2}
. This means that we can apply Lemma~\ref{le:inc} on the intervals
domain \(\inte\).  First, we define the max and min values of the
point wise lifting intervals in the following way:

\begin{definition}[\(\min\) and \(\max\)]\label{def:minmax}
  Given a command \(\com\), the corresponding finite set of variables
  \(\Var_{\com} \veq \varsof{\com}\), and an interval environment
  \(\rho : \Var_{\com} \to \Int\), we define both the \(\min\) and the
  \(\max\) value of an interval environment:
  \begin{align*}
    \max(\rho) & \veq \max\left\{\; \max \{ \max(\rho(\var)) \mid \var \in \Var_{\com} \land \max(\rho(\var)) \neq + \infty\} \; , \; 0 \; \right\} \\
    \min(\rho) & \veq \min\left\{\; \min \{ \min(\rho(\var)) \mid \var \in \Var_{\com} \land \min(\rho(\var)) \neq - \infty\} \; , \; 0 \; \right\}
  \end{align*}
\end{definition}
% 
Notice that it holds that \(\max(\rho) \geq 0\) and
\(\min(\rho) \leq 0\). This will later be useful for the base cases of
Lemma~\ref{le:inc} and Lemma~\ref{le:incnr}.  Now, when computing
\(\semi{\com} \rho\) on such \(\rho\) having a finite domain,
we can restrict to an interval domain bounded by some constant
\(k\in\n\):

\begin{definition}[Bounded interval]\label{def:boundedint}
  We define
  \(\binte{k_1}{k_2} \veq (\Var_{\com} \to \bInt{k_1}{k_2}) \cup
  \{\bot\}\) where
  \begin{align*}
    \bInt{k_1}{k_2} & \veq \{ \interval{a}{b} \mid a, b \in \z \; \land \; k_1 \leq a \leq b \leq k_2\} \\
                    & \phantom{\veq} \cup \{\interval{a}{+\infty} \mid a \in \z \; \land \; a \geq k_1\} \\
                    & \phantom{\veq} \cup \{\interval{-\infty}{b} \mid b \in \z \; \land \; b \leq k_2\}
  \end{align*}
\end{definition}

We can visualize the Hasse diagram of the bounded integer domain in
Figure~\ref{fig:bound} and notice that there are no infinite ascending
chains by definition.
% 
\begin{figure}
  \centering
  \begin{tikzpicture}
    \tikzset{node distance = .5cm}
    \node (top) {\(\top\)};
    \node (p1) [below=of top] {};
    \node (1) [left=of p1]{\(\interval{k_1}{+\infty}\)};
    \node (2) [right=of p1]{\(\interval{-\infty}{k_2}\)};
    \node (4) [below=of p1]{\(\interval{k_1}{k_2}\)};
    \node (p2) [left=of 4]{};
    \node (p3) [right=of 4]{};
    \node (3) [left=of p2]{\(\interval{k_1 + 1}{+\infty}\)};
    \node (5) [right=of p3]{\(\interval{-\infty}{k_2 - 1}\)};
    \node (p4) [below=of 4]{};
    \node (6) [left=of p4]{\(\interval{k_1 + 1}{k_2}\)};
    \node (pp1) [left=of 6]{};
    \node (d1) [left=of pp1]{\(\dots\)};
    \node (7) [right=of p4]{\(\interval{k_1}{k_2 - 1}\)};
    \node (pp2) [right=of 7]{};
    \node (d2) [right=of pp2]{\(\dots\)};
    \node (9) [below=of p4]{\(\interval{k_1 + 1}{k_2 - 1}\)};
    \node (p5) [left=of 9]{};
    \node (8) [left=of p5]{\(\interval{k_1 + 2}{k_2}\)};
    \node (p6) [right=of 9]{};
    \node (10) [right=of p6]{\(\interval{k_1}{k_2 - 2}\)};
    \node (d3) [left=of 8]{\(\dots\)};
    \node (d4) [right=of 10]{\(\dots\)};
    \node (vdot1) [below=of d3]{\(\vdots\)};
    \node (vdot2) [below=of d4]{\(\vdots\)};
    \node (dbot) [below=of 9]{\(\dots\)};
    \node (pbot2) [left=of dbot]{};
    \node (pbot1) [left=of pbot2]{};
    \node (pbot3) [right=of dbot]{};
    \node (pbot4) [right=of pbot3]{};
    \node (bot) [below=of dbot]{\(\bot\)};

    \draw
    (top) edge (1) edge (2)
    (1) edge (3) edge (4)
    (2) edge (4) edge (5)
    (3) edge (6) edge (d1)
    (4) edge (6) edge (7)
    (5) edge (7) edge (d2)
    (d1) edge (d3) edge (8)
    (6) edge (8) edge (9)
    (7) edge (9) edge (10)
    (d2) edge (10) edge (d4)
    (9) edge (dbot)
    (d3) edge (pbot1)
    (8) edge (pbot2)
    (10) edge (pbot3)
    (d4) edge (pbot4)
    (d4) edge (vdot2)
    (d3) edge (vdot1)
    (dbot) edge (bot)
    (vdot1) edge (bot)
    (vdot2) edge (bot);
  \end{tikzpicture}
  \caption{\(\bInt{k_1}{k_2}\) Hasse diagram}\label{fig:bound}
\end{figure}
% 
Now we can notice that given \(k_1, k_2 \in \z\) we can build a Galois
Connection (Definition~\ref{def:galoiscon}) between the interval
domain \(\inte\) (the \emph{concrete} domain) and the bounded interval
domain \(\binte{k_1}{k_2}\) (the \emph{abstract} domain). To do so we
first need to define a concretization and abstraction maps.

\begin{definition}\label{def:abstrcons}
  Given \(k_1, k_2\in\z\) we define a concretization map
  \(\concr[k_1,k_2] : \bInt{k_1}{k_2} \to \Int\) as the
  identity function
  \begin{equation*}
    \concr[k_1,k_2] = \id
  \end{equation*}
  while we define an abstraction map
  \(\abstr[k_1, k_2] : \Int \to \bInt{k_1}{k_2}\) in the following way
  \begin{align*}
    \abstr[k_1,k_2](\bot) & = \bot \\
    \abstr[k_1,k_2](\interval{a}{b}) & =
                                       \begin{cases}
                                         \interval{a}{b} & \text{if } a \geq k_1 \wedge b \leq k_2 \\
                                         \interval{-\infty}{b} & \text{if } a < k_1 \wedge b \leq k_2 \\
                                         \interval{a}{+\infty} & \text{if } a \geq k_1 \wedge b > k_2 \\
                                         \interval{-\infty}{+\infty} & \text{otherwise}
                                       \end{cases}
  \end{align*}
\end{definition}

Next, we prove that given \(k_1, k_2\in\z\) we in fact have a Galois
Connection:

\begin{lemma}
  Given \(k_1, k_2 \in \z\) s.t.~\({k_1 \leq k_2}\)
  \begin{equation*}
    \tuple{\Int, \sqsubseteq} \galois{\abstr[k_1, k_2]}{\id} \tuple{\bInt{k_1}{k_2}, \sqsubseteq}
  \end{equation*}
  i.e., \(\tuple{\abstr[k_1, k_2], \Int, \bInt{k_1}{k_2}, \id}\) is
  a Galois Connection.
\end{lemma}

\begin{proof}
  We want to prove that \(\id\) and \(\abstr[k_1,k_2]\) satisfy the
  property of Theorem~\ref{th:alternate}:
  \begin{enumerate}[label=(\arabic*)]
  \item\label{prop1gal} \(\abstr[k_1,k_2], \id\) are monotonic;
  \item\label{prop2gal} \(\id \circ \abstr[k_1, k_2]\) is
    extensive, i.e., \(\forall \iota \in \Int\) it holds that
    \(\iota \sqsubseteq \id(\abstr[k_1, k_2](\iota))\);
    
  \item\label{prop3gal} \(\abstr[k_1,k_2] \circ \id\) is reductive,
    i.e., \(\forall \iota_b \in \bInt{k_1}{k_2}\) it holds that
    \(\abstr[k_1, k_2](\id(\iota_b)) \sqsubseteq \iota_b\).
  \end{enumerate}

  \medskip

  \noindent
  Let us show~\ref{prop1gal}.\ \(\id\) is monotone since
  \(\forall \iota, \kappa \in \bInt{k_1}{k_2}\) it holds that
  \(\iota \sqsubseteq \kappa \Rightarrow \iota \sqsubseteq
  \kappa\). For \(\abstr[k_1,k_2]\) we have to prove that for all
  \(\iota, \kappa \in \Int\) it holds that
  \(\iota \sqsubseteq \kappa \Rightarrow \abstr[k_1,k_2](\iota)
  \sqsubseteq \abstr[k_1,k_2](\kappa)\). Now notice that
  \(\iota \sqsubseteq \kappa \) means that
  \(\min(\iota) \geq \min(\kappa)\) and
  \(\max(\iota) \leq \max(\kappa)\). Hence, by
  Definition~\ref{def:abstrcons} of \(\abstr[k_1, k_2]\) it holds that
  \(\abstr[k_1, k_2](\iota) \sqsubseteq \abstr[k_1, k_2](\kappa)\),
  which is our thesis.

  \medskip

  \noindent
  Let us now show~\ref{prop2gal}. We have to prove that
  \(\forall \iota \in \Int\) it holds that
  \(\iota \sqsubseteq \concr(\abstr[k_1,k_2](\iota))\). By hypothesis
  \(\concr = \id\), hence we just have to prove that
  \(\iota \sqsubseteq \abstr[k_1, k_2](\iota)\). Based on the
  definition of \(\abstr[k_1, k_2]\) from
  Definition~\ref{def:abstrcons} both the following hold:
  \begin{align*}
    \min(\abstr[k_1,k_2](\iota)) \leq \min(\iota) \\
    \max(\abstr[k_1,k_2](\iota)) \geq \max(\iota)
  \end{align*}
  Hence it holds that
  \begin{equation}
    \iota \sqsubseteq \abstr[k_1, k_2](\iota)
  \end{equation}

  \medskip

  \noindent
  We can finally prove~\ref{prop3gal}:
  \(\abstr[k_1, k_2] \circ \concr\) is reductive, i.e.,
  \(\forall \iota_b \in \bInt{k_1}{k_2}, \abstr[k_1,k_2](\id(\iota_b))
  \sqsubseteq \iota_b\).  Notice that
  \(\forall \iota_b \in \bInt{k_1}{k_2}\) it holds that
  \begin{equation}\label{eq:injection}
    \abstr[k_1,k_2](\iota_b) = \iota_b
  \end{equation}
  hence it holds that \(\abstr[k_1,k_2](\iota_b) \sqsubseteq \iota_b\)
\end{proof}

Notice that because of Equation~\eqref{eq:injection} holds we know
that \(\abstr[k_1,k_2] \circ\id = \id\), hence we not only have a
Galois Connection but a Galois Injection
(Definition~\ref{def:insertion}):
\begin{equation}
  \tuple{\Int, \sqsubseteq} \galoiS{\abstr[k_1, k_2]}{\id} \tuple{\bInt{k_1}{k_2}, \sqsubseteq}
\end{equation}

because of the latter observation and since
\(\inte, \binte{k_1}{k_2}\) are the point(variable)-wise lifting of
\(\Int, \bInt{k_1}{k_2}\) respectively, by Theorem~\ref{th:liftingins}
it holds that
\begin{equation}\label{eq:inteinsert}
  \tuple{\inte, \sqsubseteq} \galoiS{\dabstr[k_1,k_2]}{\id} \tuple{\binte{k_1}{k_2}, \sqsubseteq}
\end{equation}
where
\({\dabstr[k_1,k_2]}(\eta) = \lambda \var
. \abstr[k_1,k_2](\eta\var)\).
% From this we can observe that given a program \(\com\),
% \(\semi{\com} : \inte \to \inte\) is a concrete operator on
% \(\inte\) and
% \(\bsemi{k_1}{k_2}{\com} : \binte{k_1}{k_2} \to
% \binte{k_1}{k_2}\) an abstract operator on \(\binte{k_1}{k_2}\)
We can therefore define our analysis in \(\binte{k_1}{k_2}\) by means
of best correct approximations over \(\binte{k_1}{k_2}\).

\begin{notation}
  For the following definition and whenever we will need to talk about
  the abstract semantics over the interval domain bounded over some
  constants \(k_1, k_2 \in \z\) we will write
  \(\bsemi{k_1}{k_2}{\cdot}\) to refer to
  \(\bsemi{k_1}{k_2}{\cdot}\).
\end{notation}

\begin{definition}[Bounded interval analysis]\label{def:boundedanalysis}
  Let \(\rho \in \binte{k_1}{k_2}\) for some \(k_1, k_2 \in \z\) s.t.\
  \(k_1 \leq k_2\) and \(\com \in \imp\). We define
  \(\bsemi{k_1}{k_2}{\com}\rho\) as follows
  \begin{align*}
    \bsemi{k_1}{k_2}{\com[e]}\rho & \defin \dabstr[k_1,k_2] \left(\semi{\com[e]}\rho\right) \\
    \bsemi{k_1}{k_2}{\com_1 \ndet \com_2}\rho & \defin \bsemi{k_1}{k_2}{\com_1}\rho \sqcup \bsemi{k_1}{k_2}{\com_2}\rho \\
    \bsemi{k_1}{k_2}{\com_1 \seq \com_2}\rho & \defin \left(\bsemi{k_1}{k_2}{\com_2} \circ \bsemi{k_1}{k_2}{\com_1}\right)\rho \\
    \bsemi{k_1}{k_2}{\kleene{\com}}\rho & \defin \textstyle\bigsqcup_{i\in\n}{\left({\bsemi{k_1}{k_2}{\com}}\right)}^i\rho \\
    \bsemi{k_1}{k_2}{\fix{\com}}\rho & \defin \lfp\left(\lambda \mu . \rho \sqcup \bsemi{k_1}{k_2}{\com}\mu\right)
  \end{align*}
  where \(\com[e]\in\expr\). 
\end{definition}
\noindent
Notice that for basic expressions we are using the best correct
approximation \(\dabstr[k_1,k_2] \circ \semi{\com[e]} \circ \id\),
which allows us to prove the soundness of the analysis over
\(\binte{k_1}{k_2}\) w.r.t.\ the analysis over \(\inte\):
\begin{lemma}\label{le:leq}
  for all \(k_1, k_2\in\z\) s.t.\ \(k_1 \leq k_2\),
  \(\rho \in \binte{k_1}{k_2}\)
  \begin{equation*}
    \semi{\com}\rho \sqsubseteq \bsemi{k_1}{k_2}{\com}\rho
  \end{equation*}
  i.e., with \(\binte{k_1}{k_2}\) we have an over-approximation of \(\inte\).
\end{lemma}

\begin{proof}
  The theorem follows from the fact that there is a Galois connection
  \begin{equation*}
    \inte\galois{\ovdot\abstr_{k_1, k_2}}{\id}\binte{k_1}{k_2}
  \end{equation*}
  between \(\inte\) and \(\binte{k_1}{k_2}\) for all
  \(k_1, k_2 \in \z \mid k_1 \leq k_2\). Hence by
  Theorem~\ref{th:sound} follows that for all
  \(\com\in\imp, \rho \in \binte{k_1}{k_2}\)
  \begin{equation*}
    \left(\semi{\com} \conc \id \right)\;\rho \sqsubseteq  \left(\id \conc \bsemi{k_1}{k_2}{\com}\right)\;\rho
  \end{equation*}
  hence our thesis.
\end{proof}

Now we define a new bound, it will be useful for the latter
Theorem~\ref{th:bounded}.

\begin{definition}\label{def:newbound}
  Let \(\com\in\imp\). Then \(\nbound{\cdot} : \imp \to \n\) is the
  \emph{updated bound}, recursively defined as follows:
  \begin{align*}
    \nbound{\com[e]} & \defin \bound{\com[e]} \\
    \nbound{\com_1 \ndet \com_2} & \defin \nbound{\com_1} + \nbound{\com_2} \\
    \nbound{\com_1 \seq \com_2} & \defin \nbound{\com_1} + \nbound{\com_2} \\
    \nbound{\fix\com} & \defin (n+2)\nbound{\com} \\
  \end{align*}
  where \(n = \varsof{\com}\). Similarly,
  \(\nlbound{\cdot} : \imp \to \n\) is the \emph{updated lower bound}
  of commands, recursively defined as follows:
  \begin{align*}
    \nlbound{\com[e]} & \defin \lbound{\com[e]} \\
    \nlbound{\com_1 \ndet \com_2} & \defin \nlbound{\com_1} + \nlbound{\com_2} \\
    \nlbound{\com_1 \seq \com_2} & \defin \nlbound{\com_1} + \nlbound{\com_2} \\
    \nlbound{\fix\com} & \defin (n+2)\nlbound{\com} \\
  \end{align*}
\end{definition}

Notice that the updated bounds differ to bounds of
Definition~\ref{def:bound} only in the case of the \(\fix\com\)
command.  Thanks to the latter definition, we can now also define the
notion of domain bounded by initial state and program.

\begin{definition}\label{def:boundedbycom}
  Let \(\com\in\imp\) and \(\rho \in \inte\). Then the \emph{bounded
    interval domain} \(\inte_{\com,\rho}\) is a bounded interval
  \(\binte{k_1}{k_2}\) where
  \begin{align*}
    k_1 & = \min(\rho) - \nlbound{\com} \\
    k_2 & = \max(\rho) + \nbound{\com}
  \end{align*}
\end{definition}

With this consideration we can now proceed to prove that the analysis
on our bounded lattice \(\inte_{\com,\rho}\) produces the same result
as the analysis on \(\inte\).

% We could also operate uniformly on all commands, defining the
% semantics for \(\com\) in a domain with intervals bounded by
% \(\max(\rho) +\bound{\com}\)

\begin{theorem}\label{th:bounded}
  Let \(\com\in \imp\) be a command. Then, for all finitely supported
  \(\rho : \Var \to \Int\) and \(k_1, k_2\in \z\) s.t.
  \(\inte_{\com,\rho} \sqsubseteq \binte{k_1}{k_2}\), i.e.,
  \(k_1 \leq \min(\rho) - \nlbound{\com}\) and
  \(k_2 \geq \max(\rho) + \nbound{\com}\)
  \begin{equation}\label{eq:equal}
    \semi{\com}\rho = \bsemi{k_1}{k_2}{\com}\rho
  \end{equation}
  i.e., the abstract semantics \(\semi{\com} \rho\)
  % 
  % \semi{\fix{\com}} \rho & = \lfp{\lambda \rho'. (\semi{\com} \rho')
  % \sqcup \rho}
  computed in \(\inte\) and the one computed in \(\binte{k_1}{k_2}\)
  coincide.
\end{theorem}

\begin{proof}
  Notice that because of Lemma~\ref{le:leq} the statement
  \({\semi{\com}\rho} \sqsubseteq {\bsemi{k_1}{k_2}{\com}\rho}\)
  already holds. Therefore what we are left to prove is that
  \begin{equation*}
    \semi{\com}\rho \sqsupseteq \bsemi{k_1}{k_2}{\com}\rho
  \end{equation*}
  The proof will proceed by induction on the command \(\com\in\imp\).
  \begin{inductive}
    \case{\(\var\in S\)} In this case we want to prove that
    \({\semi{\var\in S}\rho \sqsupseteq
      \bsemi{k_1}{k_2}{\var\in S}\rho}\). Recall that we are
    considering
    \({k_1 \leq \min(\rho) - \nlbound{\var\in S}} = {\min(\rho) -
      \lbound{\var\in S}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var\in S}} = {\max(\rho) +
      \bound{\var\in S}}\). Notice that either
    \(\rho\var \sqcap S = \bot\), which implies that
    \(\semi{\var\in S}\rho = \bot\), and therefore
    \({\abstr[k_1,k_2](\semi{\var\in S})\rho} =
    \abstr[k_1,k_2](\bot) = \bot\) and therefore
    \(\bot \sqsupseteq \bot\) holds, or
    \(\rho\var \sqcap S = \interval{a}{b} \neq \bot\), but in this
    case
    \({\semi{\var\in S}\rho} = {\rho[\var \mapsto \rho\var
      \sqcap S]}\) and we can observe that both the following hold:
    \begin{align*}
      \min(\rho) - \lbound{\var\in S} \leq \min(\rho) \leq \min(\rho\var \sqcap S) \\
      \max(\rho\var \sqcap S) \leq \max(\rho) \leq \max(\rho) + \bound{\var\in S}
    \end{align*}
    hence
    \begin{equation*}
      \semi{\var\in S}\rho = \rho[\var \mapsto \rho\var \sqcap S] = \dabstr[k_1,k_2]\left(\semi{\var\in S}\rho\right) = \bsemi{k_1}{k_2}{\var\in S}\rho
    \end{equation*}
    which is our thesis.
    
    \case{\(\var := k\)} In this case we have to prove that
    \(\semi{\var := k}\rho \sqsupseteq
    \bsemi{k_1}{k_2}{\var := k}\rho\). Recall that we are
    considering
    \({k_1 \leq \min(\rho) - \nlbound{\var := k}} = {\min(\rho) -
      \lbound{\var := k}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var := k}}\).  We can notice
    similarly to the previous case, that because of the values of
    \(k_1\) and \(k_2\) it holds that
    \begin{equation*}
      \semi{\var := k}\rho = \rho[\var \mapsto \interval{k}{k}] = \dabstr[k_1,k_2]\left(\semi{\var := k}\rho\right) = \bsemi{k_1}{k_2}{\var := k}\rho
    \end{equation*}
    hence our thesis holds.
    
    \case{\(\var := \var[y] + k\)} In this case we have to prove that
    \(\semi{\var := \var[y] + k}\rho \sqsupseteq
    \bsemi{k_1}{k_2}{\var:=\var[y]+k}\rho\).  Recall that we
    are considering
    \({k_1 \leq \min(\rho) - \nlbound{\var:=\var[y]+k}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var:=\var[y]+k}}\). Notice also
    that
    \(\nlbound{\var := \var[y]+k} = k = \nbound{\var := \var[y] + k}\)
    and since
    \(\semi{\var:= \var[y] + k}\rho = \rho[\var \mapsto
    \rho\var[y] + k]\) we can notice that for each variable
    \(\var[w] \in \Var\) it holds that
    \begin{align*}
      \min(\rho) - k & \leq \min\left(\rho[\var \mapsto \rho\var[y] + k] \var[w]\right) \\
      \max(\rho) + k & \geq \max\left(\rho[\var \mapsto \rho\var[y] + k] \var[w]\right)
    \end{align*}
    hence
    \begin{equation*}
      \bsemi{k_1}{k_2}{\var := \var[y] + k}\rho = \dabstr[k_1,k_2]\left(\rho[\var \mapsto \rho\var[y] + k]\right) = \rho[\var \mapsto \rho\var[y] + k] = \semi{\var := \var[y] + k}\rho
    \end{equation*}
    which is our thesis
    
    \case{\(\com_1 \ndet \com_2\)} In this case we have to prove that
    \(\semi{\com_1 \ndet \com_2}\rho \sqsupseteq
    \bsemi{k_1}{k_2}{\com_1 \ndet \com_2}\rho\). Recall that we
    are considering
    \(k_1 \leq \min(\rho) - \nlbound{\com_1 \ndet \com_2}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_1 \ndet \com_2}\).  By
    inductive hypothesis it holds that
    \begin{equation*}
      \semi{\com_1}\rho = \bsemi{k_1}{k_2}{\com_1}\rho
    \end{equation*}
    for all \(k_1 \leq \min(\rho) - \nlbound{\com_1}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_1}\). Again by inductive
    hypothesis it holds that
    \begin{equation*}
      \semi{\com_2}\rho = \bsemi{k_1}{k_2}{\com_2}\rho
    \end{equation*}
    for all \(k_1 \leq \min(\rho) - \nlbound{\com_2}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_2}\). In particular, both hold
    for
    \begin{align*}
      {k_1} \leq {\min(\rho) - \nlbound{\com_1} - \nlbound{\com_2}} & = {\min(\rho) - \nlbound{\com_1 \ndet \com_2}} \\
      {k_2} \geq {\max(\rho) + \nbound{\com_1} + \nbound{\com_2}} & = {\max(\rho) + \nbound{\com_1 \ndet \com_2}}
    \end{align*}
    i.e., our initial choice of \(k_1, k_2\). We can conclude by
    closure over \(\sqcup\)
    \begin{equation*}
      \semi{\com_1 \ndet \com_2}\rho = \semi{\com_1}\rho \sqcup \semi{\com_2}\rho = \bsemi{k_1}{k_2}{\com_1}\rho \sqcup \bsemi{k_1}{k_2}{\com_2}\rho = \bsemi{k_1}{k_2}{\com_1\ndet\com_2}\rho
    \end{equation*}
    which is our thesis.

    \case{\(\com_1 \seq \com_2\)} In this case we have to prove that
    \(\semi{\com_1 \seq \com_2}\rho \sqsupseteq
    \bsemi{k_1}{k_2}{\com_1 \seq \com_2}\rho\) for all
    \({k_1 \leq \min(\rho) - \nlbound{\com_1 \seq \com_2}}\) and
    \({k_2 \geq \max(\com) + \nbound{\com_1 \seq \com_2}}\). Recall
    that
    \(\semi{\com_1\seq\com_2}\rho = {\left(\semi{\com_2}
        \circ \semi{\com_1}\right)}\rho\). By inductive
    hypothesis it holds that
    \begin{align}
      \semi{\com_1}\rho & = \bsemi{k_1}{k_2}{\com_1}\rho & \forall k_1 \leq \min(\rho) - \nlbound{\com_1} \; \land \; k_2 \geq \max(\rho) + \nbound{\com_1}\label{eq:ind1}\\
      \semi{\com_2}\rho' & = \bsemi{k_3}{k_4}{\com_2}\rho' & \forall k_3 \leq \min(\rho') - \nlbound{\com_2} \; \land \; k_4 \geq \max(\rho') + \nbound{\com_2}\label{eq:ind2}
    \end{align}
    where \(\rho' = \semi{\com_1}\rho\). In particular notice
    that both\ \eqref{eq:ind1} and\ \eqref{eq:ind2} hold for all
    \(n,m\) s.t.
    \begin{align*}
      m & \leq \min(\rho) - \nlbound{\com_1} - \nlbound{\com_2} \\
      n & \geq \max(\rho) + \nbound{\com_1} + \nbound{\com_2}
    \end{align*}
    Hence
    \begin{equation*}
      \semi{\com_1 \seq \com_2}\rho =
      \left( \semi{\com_2} \circ \semi{\com_1}\right)\rho =
      \left(\bsemi{m}{n}{\com_2} \circ \bsemi{m}{n}{\com_1}\right)\rho =
      \bsemi{m}{n}{\com_1 \seq \com_2}\rho
    \end{equation*}
    which is our thesis.

    \case{\(\fix{\com}\)} What we want to prove in this case is that
    \(\semi{\fix\com}\rho \sqsupseteq
    \bsemi{k_1}{k_2}{\fix\com}\rho\) for all
    \(k_1 \leq \min(\rho) - \nlbound{\fix\com}\) and
    \(k_2 \geq \max(\rho) + \nbound{\fix\com}\). Recall that by
    Lemma~\ref{le:sugar} \(\semi{\fix\com}\) is syntactic sugar
    for \(\semi{\kleene{(\com \ndet \tru)}}\), therefore
    \begin{align}
      \semi{\fix\com}\rho & =
      \semi{\kleene{(\com\ndet\tru)}}\rho =
      \textstyle\bigsqcup_{i\in\n}{\left(\semi{\com\ndet\tru}\right)}^i\rho \label{eq:fixtolub}\\
      \bsemi{k_1}{k_2}{\fix\com}\rho & =
      \bsemi{k_1}{k_2}{\kleene{(\com\ndet\tru)}}\rho =
      \textstyle\bigsqcup_{i\in\n}{\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^i\rho \label{eq:fixtolubk}
    \end{align}
    By latter equation we want to prove that for every \(i\in\n\) it
    holds that
    \begin{equation}
      \semi{\fix\com}\rho \sqsupseteq {\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^i\rho
    \end{equation}
    \begin{description}
    \item[Case] (\(i=0\)). In this case we can observe that our thesis
      \begin{equation*}
        \semi{\fix\com}\rho \sqsupseteq {\left(\bsemi{k_1}{k_2}{\fix\com}\right)}^0\rho = \id(\rho) = \rho
      \end{equation*}
      holds by~\eqref{eq:fixtolub}.
      
    \item[Case] (\(i \Rightarrow i+1\)). In this case we can first
      notice that
      \begin{align}
        \semi{\com\ndet\tru}{\left(\semi{\fix\com}\rho\right)} & = \semi{\com}{\left(\semi{\fix\com}\rho\right)} \sqcup {\left(\semi{\fix\com}\rho\right)} & \text{by definition of } \com\ndet\tru \nonumber \\
                                                                             & = \semi{\com}{\left(\lfp(\lambda \mu . \rho \sqcup \semi{\com}\mu )\right)} \sqcup \left(\semi{\fix\com}\rho\right) \label{eq:lastalign}
      \end{align}
      by definition of
      \(\lambda \mu . \rho \sqcup \semi{\com}\mu\) it holds
      that
      \(\lfp\left(\lambda \mu . \rho \sqcup
        \semi{\com}\mu\right)\sqsupseteq \rho\), hence
      \begin{align}
        \semi{\com}{\left(\lfp(\lambda \mu . \rho \sqcup \semi{\com}\mu )\right)} & = \rho \sqcup \semi{\com}{\left(\lfp(\lambda \mu . \rho \sqcup \semi{\com}\mu )\right)} \nonumber\\
                                                                                                & = {\lfp(\lambda \mu . \rho \sqcup \semi{\com}\mu )} \nonumber \\
                                                                                                & = \semi{\fix\com}\rho \label{eq:last}
      \end{align}
      therefore in~\eqref{eq:lastalign}
      \begin{align*}
        \semi{\com}{\left(\lfp(\lambda \mu . \rho \sqcup \semi{\com}\mu )\right)} \sqcup \left(\semi{\fix\com}\rho\right)
        & = \semi{\fix\com}\rho \sqcup \semi{\fix\com}\rho & \text{by~\eqref{eq:last}}\\
        & = \semi{\fix\com}\rho.
      \end{align*}
      We can now continue. By calling
      \(\semi{\fix\com}\rho = \beta\) we have to prove that
      \begin{equation}\label{eq:boundless}
        \semi{\com\ndet\tru}\beta \sqsupseteq \bsemi{k_1}{k_2}{\com\ndet\tru}\beta.
      \end{equation}
      for all \(k_1 \leq \min(\rho) - \nlbound{\fix\com}\) and
      \(k_2 \geq \max(\rho) + \nbound{\fix\com}\). In other words what
      we want to prove is that for every \(\var[y] \in \Var_{\com}\)
      both
      \begin{align*}
        \max(\semi{\com\ndet\tru}\beta\var[y]) & \leq k_2 \\
        \min(\semi{\com\ndet\tru}\beta\var[y]) & \geq k_1
      \end{align*}

      To start notice that
      \(\max(\beta\var[y]) \leq \max(\rho) + \bound{\fix\com}\) by
      Lemma~\ref{le:inc}. Hence by Definition~\ref{def:minmax}
      \(\max(\beta) \leq \max(\rho) + \bound{\fix\com}\), and by
      calling \(n = \varsof{\com}\) we can notice the following:
      \begin{align*}
        \max(\semi{\com\ndet\tru}\beta) & \leq \max(\beta) + \bound{\com} & \text{by Lemma~\ref{le:inc}}\\
                                               & \leq \max(\rho) + \bound{\fix\com} + \bound{\com} \\
                                               & = \max(\rho) + (n+2)\bound{\com} \\
                                               & \leq \max(\rho) + (n+2)\nbound{\com} \\
                                               & = \max(\rho) + \nbound{\fix\com} = k_2
      \end{align*}
      A similar procedure can be applied on the minimum to observe
      that
      \[\min(\semi{\com\ndet\tru}\beta) \geq \min(\rho) -
        \nlbound{\com}= k_1\]

      Hence we can conclude by observing that
      \begin{align*}
        \beta = \semi{\com\ndet\tru}\beta & \sqsupseteq \bsemi{k_1}{k_2}{\com\ndet\tru}\beta  & \text{by~\eqref{eq:boundless}}\\
                                                 & \sqsupseteq \bsemi{k_1}{k_2}{\com\ndet\tru}{\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^i\rho & \text{by induction on } i \\
        & = {\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^{i+1}\rho
      \end{align*}
      Therefore for all \(i\in\n\)
      \(\semi{\fix\com}\rho \sqsupseteq
      {\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^{i}\rho\). By
      this we can deduce that
      \begin{equation*}
        \beta = \semi{\fix\com}\rho \sqsupseteq \bigsqcup_{i\in\n}{\left(\bsemi{k_1}{k_2}{\com\ndet\tru}\right)}^i\rho = \bsemi{k_1}{k_2}{\fix\com}\rho
      \end{equation*}
      which is our thesis.
    \end{description}
  \end{inductive}
\end{proof}

% Since both
% \({\semi{\com}\rho \sqsubseteq
% \bsemi{k_1}{k_2}{\com}\rho}\) and
% \({\semi{\com}\rho \sqsupseteq
% \bsemi{k_1}{k_2}{\com}\rho}\) hold for
% \(k_1 \leq \min(\rho) - \lbound{\com}\) and
% \(k_2 \geq \max(\rho) + \bound{\com}\), then the following theorem
% holds:

% \begin{theorem}[Bounding completeness]
%   Let \(\com\in \imp\) be a command. Then, for all
%   \({\rho : \Var_{\com} \to \Int}\), and \(k_1, k_2\in \z\) s.t.
%   \(\inte_{\com,\rho} \sqsubseteq \binte{k_1}{k_2}\), i.e.,
%   \(k_1 \leq \min(\rho) - \lbound{\com}\) and
%   \(k_2 \geq \max(\rho) + \bound{\com}\)
%   \begin{equation*}
%     \semi{\com}\rho = \bsemi{k_1}{k_2}{\com}\rho
%   \end{equation*}
%   i.e., the abstract semantics \(\semi{\com} \rho\)
%   %   
%   %   \semi{\fix{\com}} \rho & = \lfp{\lambda \rho'. (\semi{\com} \rho')
%   %   \sqcup \rho}
%   computed in \(\inte\) and in \(\binte{k_1}{k_2}\) coincide.
%   \qed{}
% \end{theorem}

Our last theorem proved that by bounding the interval domain according
to the constants that appear in a program and its initial state we can
ensure termination of the analysis while achieving the most precise
abstract invariant for the program. The result is analogous to the
findings of~\cite{Gawlitza2009}, but is achieved by only looking at the
maximal and minimal values of the intermediate elements of the
analysis. This can already be seen as an hint on the goal of next
sections: while we reasoned on the values of the intermediate
analysis, we did not reason about the \emph{internal} values of
intervals. In other words if instead of intervals we considered
arbitrary sets (i.e., \emph{concave} sets) our results should still be
valid.
