% !TeX root = mod.tex
\section{Computing interval semantics}\label{sec:computingint}

Lemma~\ref{le:inc} provides an effective algorithm for computing the abstract
semantics of commands%  provided a domain that respects properties \ref{inc:hp1}
% and \ref{inc:hp2}
. This means that we can apply Lemma~\ref{le:inc} on the intervals
domain \(\inte\).  First, given a command \(\com\), the corresponding
finite set of variables \(\Var_{\com} \veq \varsof{\com}\), and an
interval environment \(\rho : \Var_{\com} \to \Int\), we define both
the \(\min\) and the \(\max\) value of an interval environment:
\begin{align*}
  \max(\rho) & \veq \max \{ \max(\rho(\var)) \mid \var \in \Var_{\com}\} \\
  \min(\rho) & \veq \max \{ \min(\rho(\var)) \mid \var \in \Var_{\com}\}
\end{align*}

% 
Then, when computing \(\semi[\inte]{\com} \rho\) on such \(\rho\)
having a finite domain, we can restrict to an interval domain bounded
by some constant \(k\in\n\):

\begin{definition}[Bounded interval]\label{def:boundedint}
  We define
  \(\binte{k_1}{k_2} \veq (\Var_{\com} \to \bInt{k_1}{k_2}) \cup
  \{\top, \bot\}\) where
  \begin{align*}
    \bInt{k_1}{k_2} & \veq \{ \interval{a}{b} \mid a, b \in \z \; \land \; k_1 \leq a \leq b \leq k_2\} \\
                    & \phantom{\veq} \cup \{\interval{a}{+\infty} \mid a \in \z \; \land \; a \geq k_1\} \\
                    & \phantom{\veq} \cup \{\interval{-\infty}{b} \mid b \in \z \; \land \; b \leq k_2\}
  \end{align*}
\end{definition}

We can visualize the Hasse diagram of the bounded integer domain in
Figure~\ref{fig:bound} and notice that there are no infinite ascending
chains by definition.
% 
\begin{figure}
  \centering
  \begin{tikzpicture}
    \tikzset{node distance = .5cm}
    \node (top) {\(\top\)};
    \node (p1) [below=of top] {};
    \node (1) [left=of p1]{\(\interval{k_1}{+\infty}\)};
    \node (2) [right=of p1]{\(\interval{-\infty}{k_2}\)};
    \node (4) [below=of p1]{\(\interval{k_1}{k_2}\)};
    \node (p2) [left=of 4]{};
    \node (p3) [right=of 4]{};
    \node (3) [left=of p2]{\(\interval{k_1 + 1}{+\infty}\)};
    \node (5) [right=of p3]{\(\interval{-\infty}{k_2 - 1}\)};
    \node (p4) [below=of 4]{};
    \node (6) [left=of p4]{\(\interval{k_1 + 1}{k_2}\)};
    \node (pp1) [left=of 6]{};
    \node (d1) [left=of pp1]{\(\dots\)};
    \node (7) [right=of p4]{\(\interval{k_1}{k_2 - 1}\)};
    \node (pp2) [right=of 7]{};
    \node (d2) [right=of pp2]{\(\dots\)};
    \node (9) [below=of p4]{\(\interval{k_1 + 1}{k_2 - 1}\)};
    \node (p5) [left=of 9]{};
    \node (8) [left=of p5]{\(\interval{k_1 + 2}{k_2}\)};
    \node (p6) [right=of 9]{};
    \node (10) [right=of p6]{\(\interval{k_1}{k_2 - 2}\)};
    \node (d3) [left=of 8]{\(\dots\)};
    \node (d4) [right=of 10]{\(\dots\)};
    \node (vdot1) [below=of d3]{\(\vdots\)};
    \node (vdot2) [below=of d4]{\(\vdots\)};
    \node (dbot) [below=of 9]{\(\dots\)};
    \node (pbot2) [left=of dbot]{};
    \node (pbot1) [left=of pbot2]{};
    \node (pbot3) [right=of dbot]{};
    \node (pbot4) [right=of pbot3]{};
    \node (bot) [below=of dbot]{\(\bot\)};

    \draw
    (top) edge (1) edge (2)
    (1) edge (3) edge (4)
    (2) edge (4) edge (5)
    (3) edge (6) edge (d1)
    (4) edge (6) edge (7)
    (5) edge (7) edge (d2)
    (d1) edge (d3) edge (8)
    (6) edge (8) edge (9)
    (7) edge (9) edge (10)
    (d2) edge (10) edge (d4)
    (9) edge (dbot)
    (d3) edge (pbot1)
    (8) edge (pbot2)
    (10) edge (pbot3)
    (d4) edge (pbot4)
    (d4) edge (vdot2)
    (d3) edge (vdot1)
    (dbot) edge (bot)
    (vdot1) edge (bot)
    (vdot2) edge (bot);
  \end{tikzpicture}
  \caption{\(\bInt{k_1}{k_2}\) Hasse diagram}\label{fig:bound}
\end{figure}
% 
Now we can notice that given \(k_1, k_2 \in \z\) we can build a Galois
Connection (Definition~\ref{def:galoiscon}) between the interval
domain \(\inte\) (the \emph{concrete} domain) and the bounded interval
domain \(\binte{k_1}{k_2}\) (the \emph{abstract} domain). To do so we
first need to define a concretization and abstraction maps.

\begin{definition}\label{def:abstrcons}
  Given \(k_1, k_2\in\z\) we define a concretization map
  \(\concr[k_1,k_2] : \bInt{k_1}{k_2} \to \Int\) as the
  identity function
  \begin{equation*}
    \concr[k_1,k_2] = \id
  \end{equation*}
  while we define an abstraction map
  \(\abstr[k_1, k_2] : \Int \to \bInt{k_1}{k_2}\) in the following way
  \begin{align*}
    \abstr[k_1,k_2](\bot) & = \bot \\
    \abstr[k_1,k_2](\interval{a}{b}) & =
                                       \begin{cases}
                                         \interval{a}{b} & \text{if } a \geq k_1 \wedge b \leq k_2 \\
                                         \interval{-\infty}{b} & \text{if } a < k_1 \wedge b \leq k_2 \\
                                         \interval{a}{+\infty} & \text{if } a \geq k_1 \wedge b > k_2 \\
                                         \interval{-\infty}{+\infty} & \text{otherwise}
                                       \end{cases}
  \end{align*}
\end{definition}

Next, we prove that given \(k_1, k_2\in\z\) we in fact have a Galois
Connection:

\begin{lemma}
  Given \(k_1, k_2 \in \z\) s.t.~\({k_1 \leq k_2}\)
  \begin{equation*}
    \tuple{\Int, \sqsubseteq} \galois{\abstr[k_1, k_2]}{\id} \tuple{\bInt{k_1}{k_2}, \sqsubseteq}
  \end{equation*}
  i.e., \(\tuple{\abstr[k_1, k_2], \Int, \bInt{k_1}{k_2}, \id}\) is
  a Galois Connection.
\end{lemma}

\begin{proof}
  We want to prove that \(\id\) and \(\abstr[k_1,k_2]\) satisfy the
  property of Theorem~\ref{th:alternate}:
  \begin{enumerate}[label=(\arabic*)]
  \item\label{prop1gal} \(\abstr[k_1,k_2], \id\) are monotonic;
  \item\label{prop2gal} \(\id \circ \abstr[k_1, k_2]\) is
    extensive, i.e., \(\forall \iota \in \Int\) it holds that
    \(\iota \sqsubseteq \id(\abstr[k_1, k_2](\iota))\);
    
  \item\label{prop3gal} \(\abstr[k_1,k_2] \circ \id\) is reductive,
    i.e., \(\forall \iota_b \in \bInt{k_1}{k_2}\) it holds that
    \(\abstr[k_1, k_2](\id(\iota_b)) \sqsubseteq \iota_b\).
  \end{enumerate}

  \medskip

  \noindent
  Let us show~\ref{prop1gal}.\ \(\id\) is monotone since
  \(\forall \iota, \kappa \in \bInt{k_1}{k_2}\) it holds that
  \(\iota \sqsubseteq \kappa \Rightarrow \iota \sqsubseteq
  \kappa\). For \(\abstr[k_1,k_2]\) we have to prove that for all
  \(\iota, \kappa \in \Int\) it holds that
  \(\iota \sqsubseteq \kappa \Rightarrow \abstr[k_1,k_2](\iota)
  \sqsubseteq \abstr[k_1,k_2](\kappa)\). Now notice that
  \(\iota \sqsubseteq \kappa \) means that
  \(\min(\iota) \geq \min(\kappa)\) and
  \(\max(\iota) \leq \max(\kappa)\). Hence, by
  Definition~\ref{def:abstrcons} of \(\abstr[k_1, k_2]\) it holds that
  \(\abstr[k_1, k_2](\iota) \sqsubseteq \abstr[k_1, k_2](\kappa)\),
  which is our thesis.

  \medskip

  \noindent
  Let us now show~\ref{prop2gal}. We have to prove that
  \(\forall \iota \in \Int\) it holds that
  \(\iota \sqsubseteq \concr(\abstr[k_1,k_2](\iota))\). By hypothesis
  \(\concr = \id\), hence we just have to prove that
  \(\iota \sqsubseteq \abstr[k_1, k_2](\iota)\). Based on the
  definition of \(\abstr[k_1, k_2]\) from
  Definition~\ref{def:abstrcons} both the following hold:
  \begin{align*}
    \min(\abstr[k_1,k_2](\iota)) \leq \min(\iota) \\
    \max(\abstr[k_1,k_2](\iota)) \geq \max(\iota)
  \end{align*}
  Hence it holds that
  \begin{equation}
    \iota \sqsubseteq \abstr[k_1, k_2](\iota)
  \end{equation}

  \medskip

  \noindent
  We can finally prove~\ref{prop3gal}:
  \(\abstr[k_1, k_2] \circ \concr\) is reductive, i.e.,
  \(\forall \iota_b \in \bInt{k_1}{k_2}, \abstr[k_1,k_2](\id(\iota_b))
  \sqsubseteq \iota_b\).  Notice that
  \(\forall \iota_b \in \bInt{k_1}{k_2}\) it holds that
  \begin{equation}\label{eq:injection}
    \abstr[k_1,k_2](\iota_b) = \iota_b
  \end{equation}
  hence it holds that \(\abstr[k_1,k_2](\iota_b) \sqsubseteq \iota_b\)
\end{proof}

Notice that because of Equation~\eqref{eq:injection} holds we know
that \(\abstr[k_1,k_2] \circ\id = \id\), hence we not only have a
Galois Connection but a Galois Injection
(Definition~\ref{def:insertion}):
\begin{equation}
  \tuple{\Int, \sqsubseteq} \galoiS{\abstr[k_1, k_2]}{\id} \tuple{\bInt{k_1}{k_2}, \sqsubseteq}
\end{equation}

because of the latter observation and since
\(\inte, \binte{k_1}{k_2}\) are the point(variable)-wise lifting of
\(\Int, \bInt{k_1}{k_2}\) respectively, by Theorem~\ref{th:liftingins}
it holds that
\begin{equation}\label{eq:inteinsert}
  \tuple{\inte, \sqsubseteq} \galoiS{\dabstr[k_1,k_2]}{\id} \tuple{\binte{k_1}{k_2}, \sqsubseteq}
\end{equation}
where
\({\dabstr[k_1,k_2]}(\eta) = \lambda \var
. \abstr[k_1,k_2](\eta\var)\).
% From this we can observe that given a program \(\com\),
% \(\semi[\inte]{\com} : \inte \to \inte\) is a concrete operator on
% \(\inte\) and
% \(\semi[\binte{k_1}{k_2}]{\com} : \binte{k_1}{k_2} \to
% \binte{k_1}{k_2}\) an abstract operator on \(\binte{k_1}{k_2}\)
We can therefore define our analysis in \(\binte{k_1}{k_2}\) by means
of best correct approximations over \(\binte{k_1}{k_2}\):

\begin{definition}[Bounded interval analysis]\label{def:boundedanalysis}
  Let \(\rho \in \binte{k_1}{k_2}\) for some \(k_1, k_2 \in \z\) s.t.\
  \(k_1 \leq k_2\) and \(\com \in \imp\). We define
  \(\semi[\binte{k_1}{k_2}]{\com}\rho\) as follows
  \begin{align*}
    \semi[\binte{k_1}{k_2}]{\com[e]}\rho & \defin \dabstr[k_1,k_2] \left(\semi[\inte]{\com[e]}\rho\right) \\
    \semi[\binte{k_1}{k_2}]{\com_1 \ndet \com_2}\rho & \defin \semi[\binte{k_1}{k_2}]{\com_1}\rho \sqcup \semi[\binte{k_1}{k_2}]{\com_2}\rho \\
    \semi[\binte{k_1}{k_2}]{\com_1 \seq \com_2}\rho & \defin \left(\semi[\binte{k_1}{k_2}]{\com_2} \circ \semi[\binte{k_1}{k_2}]{\com_1}\right)\rho \\
    \semi[\binte{k_1}{k_2}]{\kleene{\com}}\rho & \defin \textstyle\bigsqcup_{i\in\n}{\left({\semi[\binte{k_1}{k_2}]{\com}}\right)}^i\rho \\
    \semi[\binte{k_1}{k_2}]{\fix{\com}}\rho & \defin \lfp\left(\lambda \mu . \rho \sqcup \semi[\binte{k_1}{k_2}]{\com}\mu\right)
  \end{align*}
  where \(\com[e]\in\expr\). 
\end{definition}
\noindent
Notice that for basic expressions we're using the best correct
approximation
\(\dabstr[k_1,k_2] \circ \semi[\inte]{\com[e]} \circ \id\), which
allows us to prove the soundness of the analysis over
\(\binte{k_1}{k_2}\) w.r.t. the analysis over \(\inte\):
\begin{lemma}\label{le:leq}
  for all \(k_1, k_2\in\z\) s.t.\ \(k_1 \leq k_2\),
  \(\rho \in \binte{k_1}{k_2}\)
  \begin{equation*}
    \semi[\inte]{\com}\rho \sqsubseteq \semi[\binte{k_1}{k_2}]{\com}\rho
  \end{equation*}
  i.e., with \(\binte{k_1}{k_2}\) we have an over-approximation of \(\inte\).
\end{lemma}

\begin{proof}
  The theorem follows from the fact that for basic expressions we're
  using best correct approximations (from
  Definition~\ref{def:boundedanalysis}), the Galois connection ensures
  that composition preserves soundness (by Theorem~\ref{th:opcomp})
  and that least upper bounds are sound (by Property~\ref{prop:five}
  of Theorem~\ref{th:galoisprop}).
\end{proof}

Now we define a new bound, it will be useful for the latter
Theorem~\ref{th:bounded}.

\begin{definition}\label{def:newbound}
  Let \(\com\in\imp\). Then \(\nbound{\cdot} : \imp \to \n\) is the
  \emph{updated bound}, recursively defined as follows:
  \begin{align*}
    \nbound{\com[e]} & \defin \bound{\com[e]} \\
    \nbound{\com_1 \ndet \com_2} & \defin \nbound{\com_1} + \nbound{\com_2} \\
    \nbound{\com_1 \seq \com_2} & \defin \nbound{\com_1} + \nbound{\com_2} \\
    \nbound{\fix\com} & \defin (n+2)\nbound{\com} \\
  \end{align*}
  where \(n = \varsof{\com}\). Similarly,
  \(\nlbound{\cdot} : \imp \to \n\) is the \emph{updated lower bound}
  of commands, recursively defined as follows:
  \begin{align*}
    \nlbound{\com[e]} & \defin \lbound{\com[e]} \\
    \nlbound{\com_1 \ndet \com_2} & \defin \nlbound{\com_1} + \nlbound{\com_2} \\
    \nlbound{\com_1 \seq \com_2} & \defin \nlbound{\com_1} + \nlbound{\com_2} \\
    \nlbound{\fix\com} & \defin (n+2)\nlbound{\com} \\
  \end{align*}
\end{definition}

Notice that the updated bounds differ to bounds of
Definition~\ref{def:bound} only in the case of the \(\fix\com\)
command.  Thanks to the latter definition, we can now also define the
notion of domain bounded by initial state and program.

\begin{definition}\label{def:boundedbycom}
  Let \(\com\in\imp\) and \(\rho \in \inte\). Then the \emph{bounded
    interval domain} \(\inte_{\com,\rho}\) is a bounded interval
  \(\binte{k_1}{k_2}\) where
  \begin{align*}
    k_1 & = \min(\rho) - \nlbound{\com} \\
    k_2 & = \max(\rho) + \nbound{\com}
  \end{align*}
\end{definition}

With this consideration we can now proceed to prove that the analysis
on our bounded lattice \(\inte_{\com,\rho}\) produces the same result
as the analysis on \(\inte\).

% We could also operate uniformly on all commands, defining the
% semantics for \(\com\) in a domain with intervals bounded by
% \(\max(\rho) +\bound{\com}\)

\begin{theorem}\label{th:bounded}
  Let \(\com\in \imp\) be a command. Then, for all finitely supported
  \(\rho : \Var \to \Int\) and \(k_1, k_2\in \z\) s.t.
  \(\inte_{\com,\rho} \sqsubseteq \binte{k_1}{k_2}\), i.e.,
  \(k_1 \leq \min(\rho) - \nlbound{\com}\) and
  \(k_2 \geq \max(\rho) + \nbound{\com}\)
  \begin{equation}\label{eq:equal}
    \semi[\inte]{\com}\rho = \semi[\binte{k_1}{k_2}]{\com}\rho
  \end{equation}
  i.e., the abstract semantics \(\semi{\com} \rho\)
  % 
  % \semi{\fix{\com}} \rho & = \lfp{\lambda \rho'. (\semi{\com} \rho')
  % \sqcup \rho}
  computed in \(\inte\) and the one computed in \(\binte{k_1}{k_2}\)
  coincide.
\end{theorem}

\begin{proof}
  Notice that because of Lemma~\ref{le:leq} the statement
  \({\semi[\inte]{\com}\rho} \sqsubseteq
  {\semi[\binte{k_1}{k_2}]{\com}\rho}\) already holds. Therefore what
  we're left to prove is that
  \begin{equation*}
    \semi[\inte]{\com}\rho \sqsupseteq \semi[\binte{k_1}{k_2}]{\com}\rho
  \end{equation*}
  The proof will proceed by induction on the command \(\com\in\imp\).
  \begin{inductive}
    \case{\(\var\in S\)} In this case we want to prove that
    \({\semi[\inte]{\var\in S}\rho \sqsupseteq
      \semi[\binte{k_1}{k_2}]{\var\in S}\rho}\). Recall that we are
    considering
    \({k_1 \leq \min(\rho) - \nlbound{\var\in S}} = {\min(\rho) -
      \lbound{\var\in S}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var\in S}} = {\max(\rho) +
      \bound{\var\in S}}\). Notice that either
    \(\rho\var \sqcap S = \bot\), which implies that
    \(\semi[\inte]{\var\in S}\rho = \bot\), and therefore
    \({\abstr[k_1,k_2](\semi[\inte]{\var\in S})\rho} =
    \abstr[k_1,k_2](\bot) = \bot\) and therefore
    \(\bot \sqsupseteq \bot\) holds, or
    \(\rho\var \sqcap S = \interval{a}{b} \neq \bot\), but in this
    case
    \({\semi[\inte]{\var\in S}\rho} = {\rho[\var \mapsto \rho\var
      \sqcap S]}\) and we can observe that both the following hold:
    \begin{align*}
      \min(\rho) - \lbound{\var\in S} \leq \min(\rho) \leq \min(\rho\var \sqcap S) \\
      \max(\rho\var \sqcap S) \leq \max(\rho) \leq \max(\rho) + \bound{\var\in S}
    \end{align*}
    hence
    \begin{equation*}
      \semi[\inte]{\var\in S}\rho = \rho[\var \mapsto \rho\var \sqcap S] = \dabstr[k_1,k_2]\left(\semi[\inte]{\var\in S}\rho\right) = \semi[\binte{k_1}{k_2}]{\var\in S}\rho
    \end{equation*}
    which is our thesis.
    
    \case{\(\var := k\)} In this case we have to prove that
    \(\semi[\inte]{\var := k}\rho \sqsupseteq
    \semi[\binte{k_1}{k_2}]{\var := k}\rho\). Recall that we are
    considering
    \({k_1 \leq \min(\rho) - \nlbound{\var := k}} = {\min(\rho) -
      \lbound{\var := k}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var := k}}\).  We can notice
    similarly to the previous case, that because of the values of
    \(k_1\) and \(k_2\) it holds that
    \begin{equation*}
      \semi[\inte]{\var := k}\rho = \rho[\var \mapsto \interval{k}{k}] = \dabstr[k_1,k_2]\left(\semi[\inte]{\var := k}\rho\right) = \semi[\binte{k_1}{k_2}]{\var := k}\rho
    \end{equation*}
    hence our thesis holds.
    
    \case{\(\var := \var[y] + k\)} In this case we have to prove that
    \(\semi[\inte]{\var := \var[y] + k}\rho \sqsupseteq
    \semi[\binte{k_1}{k_2}]{\var:=\var[y]+k}\rho\).  Recall that we
    are considering
    \({k_1 \leq \min(\rho) - \nlbound{\var:=\var[y]+k}}\) and
    \({k_2 \geq \max(\rho) + \nbound{\var:=\var[y]+k}}\). Notice also
    that
    \(\nlbound{\var := \var[y]+k} = k = \nbound{\var := \var[y] + k}\)
    and since
    \(\semi[\inte]{\var:= \var[y] + k}\rho = \rho[\var \mapsto
    \rho\var[y] + k]\) we can notice that for each variable
    \(\var[w] \in \Var\) it holds that
    \begin{equation*}
      \min(\rho) - k \leq \left(\rho[\var \mapsto \rho\var[y] + k]\right) (\var[w]) \leq \max(\rho) + k
    \end{equation*}
    hence
    \begin{equation*}
      \semi[\binte{k_1}{k_2}]{\var := \var[y] + k}\rho = \dabstr[k_1,k_2]\left(\rho[\var \mapsto \rho\var[y] + k]\right) = \rho[\var \mapsto \rho\var[y] + k] = \semi[\inte]{\var := \var[y] + k}\rho
    \end{equation*}
    which is our thesis
    
    \case{\(\com_1 \ndet \com_2\)} In this case we have to prove that
    \(\semi[\inte]{\com_1 \ndet \com_2}\rho \sqsupseteq
    \semi[\binte{k_1}{k_2}]{\com_1 \ndet \com_2}\rho\). Recall that we
    are considering
    \(k_1 \leq \min(\rho) - \nlbound{\com_1 \ndet \com_2}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_1 \ndet \com_2}\).  By
    inductive hypothesis it holds that
    \begin{equation*}
      \semi[\inte]{\com_1}\rho = \semi[\binte{k_1}{k_2}]{\com_1}\rho
    \end{equation*}
    for all \(k_1 \leq \min(\rho) - \nlbound{\com_1}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_1}\). Again by inductive
    hypothesis it holds that
    \begin{equation*}
      \semi[\inte]{\com_2}\rho = \semi[\binte{k_1}{k_2}]{\com_2}\rho
    \end{equation*}
    for all \(k_1 \leq \min(\rho) - \nlbound{\com_2}\) and
    \(k_2 \geq \max(\rho) + \nbound{\com_2}\). In particular, both hold
    for
    \({k_1} \leq {\min(\rho) - \nlbound{\com_1} - \nlbound{\com_2}} =
    {\min(\rho) - \nlbound{\com_1 \ndet \com_2}}\) and
    \({k_2} \geq {\max(\rho) + \nbound{\com_1} + \nbound{\com_2}} =
    {\max(\rho) + \nbound{\com_1 \ndet \com_2}}\), i.e., our initial
    choice of \(k_1, k_2\). We can conclude by closure over \(\sqcup\)
    \begin{equation*}
      \semi[\inte]{\com_1 \ndet \com_2}\rho = \semi[\inte]{\com_1}\rho \sqcup \semi[\inte]{\com_2}\rho = \semi[\binte{k_1}{k_2}]{\com_1}\rho \sqcup \semi[\binte{k_1}{k_2}]{\com_2}\rho = \semi[\binte{k_1}{k_2}]{\com_1\ndet\com_2}\rho
    \end{equation*}
    which is our thesis.

    \case{\(\com_1 \seq \com_2\)} In this case we have to prove that
    \(\semi[\inte]{\com_1 \seq \com_2}\rho \sqsupseteq
    \semi[\binte{k_1}{k_2}]{\com_1 \seq \com_2}\rho\) for all
    \({k_1 \leq \min(\rho) - \nlbound{\com_1 \seq \com_2}}\) and
    \({k_2 \geq \max(\com) + \nbound{\com_1 \seq \com_2}}\). Recall
    that
    \(\semi[\inte]{\com_1\seq\com_2}\rho = {\left(\semi[\inte]{\com_2}
        \circ \semi[\inte]{\com_1}\right)}\rho\). By inductive
    hypothesis it holds that
    \begin{align}
      \semi[\inte]{\com_1}\rho & = \semi[\binte{k_1}{k_2}]{\com_1}\rho & \forall k_1 \leq \min(\rho) - \nlbound{\com_1} \; \land \; k_2 \geq \max(\rho) + \nbound{\com_1}\tag{\dag}\label{eq:ind1}\\
      \semi[\inte]{\com_2}\rho' & = \semi[\binte{k_3}{k_4}]{\com_2}\rho' & \forall k_3 \leq \min(\rho') - \nlbound{\com_2} \; \land \; k_4 \geq \max(\rho') + \nbound{\com_2}\tag{\ddag}\label{eq:ind2}
    \end{align}
    where \(\rho' = \semi[\inte]{\com_1}\rho\). In particular notice
    that both\ \eqref{eq:ind1} and\ \eqref{eq:ind2} hold for all
    \(n,m\) s.t.
    \begin{align*}
      m & \leq \min(\rho) - \nlbound{\com_1} - \nlbound{\com_2} \\
      n & \geq \max(\rho) + \nbound{\com_1} + \nbound{\com_2}
    \end{align*}
    Hence
    \begin{equation*}
      \semi[\inte]{\com_1 \seq \com_2}\rho =
      \left( \semi[\inte]{\com_2} \circ \semi[\inte]{\com_1}\right)\rho =
      \left(\semi[\binte{m}{n}]{\com_2} \circ \semi[\binte{m}{n}]{\com_1}\right)\rho =
      \semi[\binte{m}{n}]{\com_1 \seq \com_2}\rho
    \end{equation*}
    which is our thesis.

    \case{\(\fix{\com}\)} What we want to prove in this case is that
    \(\semi[\inte]{\fix\com}\rho \sqsupseteq
    \semi[\binte{k_1}{k_2}]{\fix\com}\rho\) for all
    \(k_1 \leq \min(\rho) - \nlbound{\fix\com}\) and
    \(k_2 \geq \max(\rho) + \nbound{\fix\com}\). Recall that by
    Lemma~\ref{le:sugar} \(\semi[\inte]{\fix\com}\) is syntactic sugar
    for \(\semi[\inte]{\kleene{(\com \ndet \tru)}}\), therefore
    \begin{equation}\label{eq:fixtolub}
      \semi[\inte]{\fix\com}\rho =
      \semi[\inte]{\kleene{(\com\ndet\tru)}}\rho =
      \textstyle\bigsqcup_{i\in\n}{\left(\semi[\inte]{\com\ndet\tru}\right)}^i\rho
    \end{equation}
    and we can build the chain of iterands \(\rho_i\) inductively in
    the following way
    \begin{align*}
      \rho_0 & \defin \rho \\
      \rho_{i+1} & \defin \semi[\inte]{\com\ndet\tru}\rho_i = {\left(\semi[\inte]{\com\ndet\tru}\right)}^{i+1}\rho
    \end{align*}
    based on the value of \(\max(\semi[\inte]{\fix\com}\rho\var[y])\)
    we want to prove that both
    \(\max(\semi[\inte]{\fix\com}\rho\var[y]) \geq
    \max(\semi[\binte{k_1}{k_2}]{\fix\com}\rho)\) and
    \(\min(\semi[\inte]{\fix\com}\rho\var[y]) \leq
    \min(\semi[\binte{k_1}{k_2}]{\fix\com}\rho)\). For every variable
    \(\var[y] \in \Var_{\com}\) we have 2 cases:
    \begin{enumerate}[label=(\roman*)]
    \item If \(\max(\semi[\inte]{\fix\com}\rho\var[y]) = + \infty\)
      (or \(\min(\semi[\inte]{\fix\com}\rho\var[y]) = - \infty\)) then
      we can recall Lemma~\ref{le:leq} and notice that it holds that
      \({\semi[\inte]{\fix\com}\rho} \sqsubseteq
      {\semi[\binte{k_1}{k_2}]{\fix\com}\rho}\), hence
      \begin{align*}
        +\infty = \max({\semi[\inte]{\fix\com}\rho\var[y]}) & \leq \max({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}) = +\infty \\
        -\infty = \min({\semi[\inte]{\fix\com}\rho\var[y]}) & \geq \min({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}) = -\infty
      \end{align*}
      but this means that
      \(+\infty = {\max({\semi[\inte]{\fix\com}\rho\var[y]})} =
      {\max\left({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}\right)}\)
      and
      \(-\infty = {\min({\semi[\inte]{\fix\com}\rho\var[y]})} =
      {\min\left({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}\right)}\)
      hold and the following inequality also hold:
      \begin{align*}
        +\infty = \max({\semi[\inte]{\fix\com}\rho\var[y]}) & \geq \max({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}) = +\infty \\
        -\infty = \min({\semi[\inte]{\fix\com}\rho\var[y]}) & \leq \min({\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y]}) = -\infty
      \end{align*}
    \item Otherwise we have to prove that
      \({\max(\semi[\inte]{\fix\com}\rho\var[y])} \geq
      {\max(\semi[\binte{k_1}{k_2}]{\fix\com}\rho)}\) and
      \({\min(\semi[\inte]{\fix\com}\rho\var[y])} \leq
      {\min(\semi[\binte{k_1}{k_2}]{\fix\com}\rho\var[y])}\) when
      respectively
      \({\max(\semi[\inte]{\fix\com}\rho\var[y]) \neq + \infty}\) and
      \({\min(\semi[\inte]{\fix\com}\rho\var[y]) \neq -\infty}\). In
      this case we also build the chain of iterands over the bounded
      analysis
      \begin{align*}
        \rho_0'& \defin \rho \\
        \rho_{i+1}' & \defin \semi[\binte{k_1}{k_2}]{\com\ndet\tru}\rho_i'
      \end{align*}
      What we want to prove, is that \(\rho_{i+1} = \rho_{i+1}'\)
      holds for every \(i\in\n\), this way the two chains hold the
      same result. To do so we work by induction on \(i\):
      \begin{description}
      \item[Case] (\(i=0\)). In this case, by induction on
        \(\com\ndet\tru\) we know that
        \[\semi[\inte]{\com\ndet\tru}\rho =
          \semi[\binte{k_1}{k_2}]{\com\ndet\tru}\rho\] for all
        \(k_1 \leq \min(\rho) - \nlbound{\com\ndet\tru} = \min(\rho) -
        \nlbound{\com}\) and
        \(k_2 \geq \max(\rho) + \nbound{\com\ndet\tru} = \max(\rho) +
        \nbound{\com}\). Hence by our choice of \(k_1, k_2\) it holds.
        
      \item[Case] (\(i\Rightarrow i+1\)). In this case we have to
        prove
        \begin{equation*}
          \rho_{i+1} = \semi[\inte]{\com\ndet\tru}\rho_i \quad = \quad \semi[\binte{k_1}{k_2}]{\com\ndet\tru}\rho_i' = \rho_{i+1}'
        \end{equation*}
        To start, by induction on \(i\) we can say that
        \(\rho_i = \rho_i' = \rho''\). By induction on \(\com\ndet\tru\) we can
        say that
        \begin{equation}
          \semi[\inte]{\com\ndet\tru}\rho'' = \semi[\binte{k_1}{k_2}]{\com\ndet\tru}\rho''
        \end{equation}
        for all \(k_1 \leq \min(\rho'') - \nlbound{\com}\) and
        \(k_2 \geq \max(\rho'') + \nbound{\com}\). Now we can observe
        that because of~\eqref{eq:fixtolub} and Lemma~\ref{le:inc} it
        holds that
        \begin{align*}
          \min(\rho'') & \geq \min(\rho) - \nlbound{\fix\com} = \min(\rho) - (n+1)\nlbound{\com} \\
          \max(\rho'') & \leq \max(\rho) + \nbound{\fix\com} = \max(\rho) + (n+1)\nbound{\com}
        \end{align*}
        hence by choosing
        \begin{align*}
          k_1 & \leq \min(\rho) - \nlbound{\fix\com} - \nlbound{\com} = \min(\rho) - (n+2)\nlbound{\com} \\
          k_2 & \geq \max(\rho) + \nbound{\fix\com} + \nbound{\com} = \max(\rho) + (n+2)\nbound{\com}
        \end{align*}
        the inductive hypothesis holds and we can conclude that
        \begin{equation}
          \rho_{i+1} = \semi[\inte]{\com\ndet\tru}\rho_i = \semi[\binte{k_1}{k_2}]{\com\ndet\tru}\rho_i' = \rho_{i+1}'
        \end{equation}
      \end{description}
      Hence the following
      \begin{equation*}
        \semi[\inte]{\fix\com}\rho =
        \textstyle\bigsqcup_{i\in\n}{\left(\semi[\inte]{\com\ndet\tru}\right)}^i \rho =
        \textstyle\bigsqcup_{i\in\n}{\left(\semi[\binte{k_1}{k_2}]{\com\ndet\tru}\right)}^i \rho =
        \semi[\binte{k_1}{k_2}]{\fix\com}\rho
      \end{equation*}
      holds for every \(k_1 \leq \min(\rho) - (n+2)\nlbound{\com}\) and
      \(k_2 \geq \max(\rho) + (n+2)\nbound{\com}\), which is our
      thesis.
    \end{enumerate}
  \end{inductive}
\end{proof}

% Since both
% \({\semi[\inte]{\com}\rho \sqsubseteq
% \semi[\binte{k_1}{k_2}]{\com}\rho}\) and
% \({\semi[\inte]{\com}\rho \sqsupseteq
% \semi[\binte{k_1}{k_2}]{\com}\rho}\) hold for
% \(k_1 \leq \min(\rho) - \lbound{\com}\) and
% \(k_2 \geq \max(\rho) + \bound{\com}\), then the following theorem
% holds:

% \begin{theorem}[Bounding completeness]
%   Let \(\com\in \imp\) be a command. Then, for all
%   \({\rho : \Var_{\com} \to \Int}\), and \(k_1, k_2\in \z\) s.t.
%   \(\inte_{\com,\rho} \sqsubseteq \binte{k_1}{k_2}\), i.e.,
%   \(k_1 \leq \min(\rho) - \lbound{\com}\) and
%   \(k_2 \geq \max(\rho) + \bound{\com}\)
%   \begin{equation*}
%     \semi[\inte]{\com}\rho = \semi[\binte{k_1}{k_2}]{\com}\rho
%   \end{equation*}
%   i.e., the abstract semantics \(\semi{\com} \rho\)
%   %   
%   %   \semi{\fix{\com}} \rho & = \lfp{\lambda \rho'. (\semi{\com} \rho')
%   %   \sqcup \rho}
%   computed in \(\inte\) and in \(\binte{k_1}{k_2}\) coincide.
%   \qed{}
% \end{theorem}
